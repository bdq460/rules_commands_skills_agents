# 安全检查清单

本文档提供系统安全检查清单，用于全面评估系统的安全状况。

## 🔐 认证和授权安全

### 1. 认证机制

**检查项**：

- [ ] **密码策略**
  - [ ] 密码最小长度要求（至少8位）
  - [ ] 密码复杂度要求（大小写字母、数字、特殊字符）
  - [ ] 密码过期策略
  - [ ] 禁止使用常见密码
  - [ ] 密码历史记录检查
  - [ ] 密码重置流程安全

- [ ] **密码存储**
  - [ ] 使用强哈希算法（bcrypt、Argon2、PBKDF2）
  - [ ] 盐值（salt）正确使用
  - [ ] 不使用明文存储密码
  - [ ] 不使用弱哈希算法（MD5、SHA1）

- [ ] **会话管理**
  - [ ] 会话ID随机且足够长
  - [ ] 会话超时机制
  - [ ] 登出后立即销毁会话
  - [ ] 会话固定攻击防护
  - [ ] 并发登录限制
  - [ ] 登录失败次数限制

- [ ] **多因素认证（MFA）**
  - [ ] 支持MFA（可选或强制）
  - [ ] MFA验证码有效期
  - [ ] MFA备用验证方式
  - [ ] 记住设备功能安全

### 2. 授权机制

**检查项**：

- [ ] **权限验证**
  - [ ] 所有API端点都有权限检查
  - [ ] 最小权限原则
  - [ ] 权限继承和覆盖正确
  - [ ] 权限变更即时生效

- [ ] **RBAC（基于角色的访问控制）**
  - [ ] 角色定义清晰
  - [ ] 权限分配合理
  - [ ] 避免权限升级
  - [ ] 审计日志记录

- [ ] **ABAC（基于属性的访问控制）**
  - [ ] 属性定义合理
  - [ ] 策略引擎正确
  - [ ] 属性变更及时同步

- [ ] **越权访问防护**
  - [ ] 水平越权（Horizontal Privilege Escalation）
  - [ ] 垂直越权（Vertical Privilege Escalation）
  - [ ] IDOR（不安全的直接对象引用）
  - [ ] 权限检查在服务层实现

## 🛡️ 输入验证和输出编码

### 1. 输入验证

**检查项**：

- [ ] **白名单验证**
  - [ ] 使用白名单而非黑名单
  - [ ] 验证输入类型、格式、长度
  - [ ] 验证输入范围
  - [ ] 特殊字符过滤

- [ ] **SQL注入防护**
  - [ ] 使用参数化查询
  - [ ] 使用ORM/查询构建器
  - [ ] 不拼接SQL语句
  - [ ] 存储过程安全使用

- [ ] **命令注入防护**
  - [ ] 避免直接执行命令
  - [ ] 使用安全API替代系统命令
  - [ ] 输入转义和验证

- [ ] **XSS防护**
  - [ ] 输出编码（HTML、JavaScript、URL）
  - [ ] CSP（内容安全策略）
  - [ ] 不使用eval()等危险函数
  - [ ] 富文本编辑器安全配置

- [ ] **文件上传安全**
  - [ ] 文件类型白名单
  - [ ] 文件大小限制
  - [ ] 文件名验证和重命名
  - [ ] 上传目录不可执行
  - [ ] 病毒扫描
  - [ ] 访问控制

- [ ] **路径遍历防护**
  - [ ] 验证路径合法性
  - [ ] 不使用用户输入的路径
  - [ ] 使用安全API处理路径

### 2. 输出编码

**检查项**：

- [ ] **HTML编码**
  - [ ] 转义 `<`, `>`, `&`, `"`, `'` 等字符
  - [ ] 使用模板引擎自动转义

- [ ] **JavaScript编码**
  - [ ] 防止XSS攻击
  - [ ] 不直接使用用户输入

- [ ] **URL编码**
  - [ ] 正确编码URL参数
  - [ ] 避免URL重定向漏洞

## 🔒 数据安全

### 1. 数据加密

**检查项**：

- [ ] **传输加密**
  - [ ] 强制使用HTTPS
  - [ ] TLS 1.2或更高版本
  - [ ] 禁用弱加密套件
  - [ ] HSTS启用

- [ ] **存储加密**
  - [ ] 敏感数据加密存储
  - [ ] 数据库字段加密
  - [ ] 文件加密
  - [ ] 使用强加密算法（AES-256）

- [ ] **密钥管理**
  - [ ] 密钥安全存储
  - [ ] 密钥轮换策略
  - [ ] 密钥访问控制
  - [ ] 使用密钥管理服务（KMS）

### 2. 数据保护

**检查项**：

- [ ] **数据脱敏**
  - [ ] 日志中敏感信息脱敏
  - [ ] 错误信息不泄露数据
  - [ ] 显示时部分隐藏（如手机号）

- [ ] **数据备份**
  - [ ] 定期备份
  - [ ] 备份加密
  - [ ] 备份访问控制
  - [ ] 备份测试恢复

- [ ] **数据删除**
  - [ ] 彻底删除敏感数据
  - [ ] 数据保留策略
  - [ ] 隐私合规（GDPR、CCPA）

### 3. 数据库安全

**检查项**：

- [ ] **访问控制**
  - [ ] 最小权限原则
  - [ ] 不使用root/admin账户
  - [ ] 网络访问限制
  - [ ] 数据库防火墙

- [ ] **安全配置**
  - [ ] 禁用不必要的功能
  - [ ] 安全审计日志
  - [ ] 加密连接
  - [ ] 定期更新补丁

- [ ] **敏感字段保护**
  - [ ] 加密存储
  - [ ] 列级权限控制
  - [ ] 查询结果过滤

## 🌐 API安全

### 1. API认证

**检查项**：

- [ ] **认证机制**
  - [ ] JWT签名验证
  - [ ] Token有效期设置
  - [ ] Token刷新机制
  - [ ] API Key安全使用

- [ ] *`OAuth 2.0`*
  - [ ] 正确使用授权流程
  - [ ] Token存储安全
  - [ ] Token撤销机制
  - [ ] PKCE启用（移动端）

### 2. API授权

**检查项**：

- [ ] **Scope管理**
  - [ ] 最小Scope原则
  - [ ] Scope合理划分
  - [ ] 用户授权

- [ ] **资源访问控制**
  - [ ] 权限验证
  - [ ] 资源所有者检查
  - [ ] 防止越权访问

### 3. API安全实践

**检查项**：

- [ ] **速率限制**
  - [ ] API调用频率限制
  - [ ] 防止暴力破解
  - [ ] 基于用户的限制
  - [ ] 基于IP的限制

- [ ] **输入验证**
  - [ ] 请求体验证
  - [ ] 参数验证
  - [ ] 类型检查

- [ ] **错误处理**
  - [ ] 不泄露敏感信息
  - [ ] 统一错误格式
  - [ ] 记录错误日志

- [ ] **CORS配置**
  - [ ] 正确配置CORS
  - [ ] 限制允许的域名
  - [ ] 预检请求处理

- [ ] **API版本控制**
  - [ ] 版本策略
  - [ ] 废弃版本处理
  - [ ] 向后兼容性

## 🌍 Web安全

### 1. OWASP Top 10

**检查项**：

- [ ] *`A01: Broken Access Control（失效的访问控制）`*
  - [ ] 权限验证
  - [ ] 防止越权访问

- [ ] *`A02: Cryptographic Failures（加密失败）`*
  - [ ] 使用强加密算法
  - [ ] 敏感数据加密

- [ ] *`A03: Injection（注入）`*
  - [ ] SQL注入防护
  - [ ] 命令注入防护
  - [ ] XSS防护

- [ ] *`A04: Insecure Design（不安全设计）`*
  - [ ] 安全威胁建模
  - [ ] 安全架构设计

- [ ] *`A05: Security Misconfiguration（安全配置错误）`*
  - [ ] 默认配置修改
  - [ ] 关闭不必要功能
  - [ ] 错误页面处理

- [ ] *`A06: Vulnerable and Outdated Components（易受攻击和过时的组件）`*
  - [ ] 依赖包更新
  - [ ] 漏洞扫描
  - [ ] 使用可信依赖

- [ ] *`A07: Identification and Authentication Failures（识别和认证失败）`*
  - [ ] 密码策略
  - [ ] 会话管理
  - [ ] MFA

- [ ] *`A08: Software and Data Integrity Failures（软件和数据完整性失败）`*
  - [ ] 代码签名
  - [ ] 数据完整性检查
  - [ ] CI/CD流水线安全

- [ ] *`A09: Security Logging and Monitoring Failures（安全日志和监控失败）`*
  - [ ] 审计日志
  - [ ] 异常检测
  - [ ] 告警机制

- [ ] *`A10: Server-Side Request Forgery (SSRF)（服务端请求伪造）`*
  - [ ] SSRF防护
  - [ ] URL白名单
  - [ ] 网络隔离

### 2. HTTP安全头

**检查项**：

- [ ] **安全响应头**

  ```http
  Strict-Transport-Security: max-age=31536000; includeSubDomains
  X-Content-Type-Options: nosniff
  X-Frame-Options: DENY
  X-XSS-Protection: 1; mode=block
  Content-Security-Policy: default-src 'self'
  Referrer-Policy: strict-origin-when-cross-origin
  Permissions-Policy: geolocation=(), microphone=(), camera=()

  ```

- [ ] **Cookie安全**
  - [ ] HttpOnly标志
  - [ ] Secure标志
  - [ ] SameSite属性
  - [ ] Cookie过期时间

### 3. 跨站请求伪造（CSRF）防护

**检查项**：

- [ ] **CSRF Token**
  - [ ] Token验证
  - [ ] Token随机性
  - [ ] Token一次性使用

- [ ] **SameSite Cookie**
  - [ ] 设置SameSite属性

- [ ] **自定义Header验证**
  - [ ] 使用X-Requested-With等自定义头

## 📝 日志和监控

### 1. 安全日志

**检查项**：

- [ ] **日志记录**
  - [ ] 登录/登出日志
  - [ ] 权限变更日志
  - [ ] 数据访问日志
  - [ ] 错误日志
  - [ ] 安全事件日志

- [ ] **日志内容**
  - [ ] 用户信息
  - [ ] 时间戳
  - [ ] 操作类型
  - [ ] IP地址
  - [ ] 请求参数（脱敏）

- [ ] **日志保护**
  - [ ] 敏感信息脱敏
  - [ ] 日志访问控制
  - [ ] 日志完整性保护

### 2. 安全监控

**检查项**：

- [ ] **实时监控**
  - [ ] 异常登录检测
  - [ ] 暴力破解检测
  - [ ] 异常访问检测
  - [ ] 流量异常检测

- [ ] **告警机制**
  - [ ] 告警规则
  - [ ] 告警通知
  - [ ] 告警响应流程

- [ ] **入侵检测**
  - [ ] IDS/IPS部署
  - [ ] 异常行为分析
  - [ ] 威胁情报集成

## 🔧 开发安全

### 1. 依赖安全

**检查项**：

- [ ] **依赖管理**
  - [ ] 定期更新依赖
  - [ ] 使用依赖锁定文件
  - [ ] 删除未使用依赖

- [ ] **漏洞扫描**
  - [ ] 使用npm audit、snyk等工具
  - [ ] 定期扫描
  - [ ] 漏洞修复跟踪

- [ ] **安全来源**
  - [ ] 使用可信仓库
  - [ ] 验证包签名
  - [ ] 检查维护活跃度

### 2. 代码安全

**检查项**：

- [ ] **代码审查**
  - [ ] 安全代码审查
  - [ ] 使用安全编码规范
  - [ ] 静态代码分析

- [ ] **安全编码实践**
  - [ ] 不使用eval()
  - [ ] 不使用exec()
  - [ ] 输入验证和输出编码
  - [ ] 错误处理

- [ ] **敏感信息处理**
  - [ ] 不硬编码密钥
  - [ ] 使用环境变量
  - [ ] 使用密钥管理服务

## 🚀 DevSecOps

### 1. CI/CD安全

**检查项**：

- [ ] **流水线安全**
  - [ ] 代码签名
  - [ ] 安全测试集成
  - [ ] 依赖扫描
  - [ ] 静态分析
  - [ ] 容器镜像扫描

- [ ] **访问控制**
  - [ ] 流水线访问控制
  - [ ] 凭证管理
  - [ ] 审计日志

### 2. 基础设施安全

**检查项**：

- [ ] **容器安全**
  - [ ] 使用官方基础镜像
  - [ ] 最小化镜像
  - [ ] 非root用户运行
  - [ ] 镜像漏洞扫描

- [ ] **配置管理**
  - [ ] 敏感配置加密
  - [ ] 配置版本控制
  - [ ] 配置审计

- [ ] **网络隔离**
  - [ ] 网络分段
  - [ ] 防火墙规则
  - [ ] 零信任架构

## 📋 安全评估清单

### 1. 威胁建模

**检查项**：

- [ ] 识别资产
- [ ] 识别威胁
- [ ] 风险评估
- [ ] 缓解措施

### 2. 渗透测试

**检查项**：

- [ ] 黑盒测试
- [ ] 白盒测试
- [ ] 灰盒测试
- [ ] 社会工程学测试

### 3. 安全审计

**检查项**：

- [ ] 代码审计
- [ ] 配置审计
- [ ] 日志审计
- [ ] 访问审计

## 📚 参考资料

- OWASP Top 10
- OWASP Testing Guide
- OWASP Cheat Sheet Series
- CIS Benchmarks
- NIST Cybersecurity Framework
- ISO 27001
- PCI DSS
